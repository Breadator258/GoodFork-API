<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>api/models/Order.js - The Good Fork - API</title>
    
    <meta name="description" content="Online documentation of the good fork api" />
    
        <meta name="keywords" content="the, good, fork, api, doc, documentation" />
        <meta name="keyword" content="the, good, fork, api, doc, documentation" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/Breadator258/3PROJ-WEB_API" target="_blank" class="menu-item" id="github_link" >GitHub</a></h2><h2><a href="./api_routes.html" class="menu-item" id="api_routes_link" >API Routes</a></h2><h3>Classes</h3><ul><li><a href="ModelError.html">ModelError</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ModelError.html#.code">code</a></li><li data-type='method' style='display: none;'><a href="ModelError.html#.message">message</a></li><li data-type='method' style='display: none;'><a href="ModelError.html#.fields">fields</a></li><li data-type='method' style='display: none;'><a href="ModelError.html#.json">json</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-middlewares.html">middlewares</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-middlewares.html#~checkParams">checkParams</a></li><li data-type='method' style='display: none;'><a href="module-middlewares.html#~database">database</a></li><li data-type='method' style='display: none;'><a href="module-middlewares.html#~toLowercase">toLowercase</a></li></ul></li><li></li><li></li><li></li><li><a href="module-models_Booking.html">models/Booking</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~getByUserId">getByUserId</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~getActiveByUserId">getActiveByUserId</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~getAllActive">getAllActive</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~getAllToday">getAllToday</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~buildBookings">buildBookings</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~update">update</a></li><li data-type='method' style='display: none;'><a href="module-models_Booking.html#~delete">delete</a></li></ul></li><li><a href="module-models_Measurement.html">models/Measurement</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Measurement.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_Measurement.html#~getByName">getByName</a></li><li data-type='method' style='display: none;'><a href="module-models_Measurement.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-models_Measurement.html#~getAllByTypes">getAllByTypes</a></li><li data-type='method' style='display: none;'><a href="module-models_Measurement.html#~convert">convert</a></li><li data-type='method' style='display: none;'><a href="module-models_Measurement.html#~buildMeasurement">buildMeasurement</a></li></ul></li><li><a href="module-models_MeasurementType.html">models/MeasurementType</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_MeasurementType.html#~getAll">getAll</a></li></ul></li><li><a href="module-models_MeasurementUnit.html">models/MeasurementUnit</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_MeasurementUnit.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_MeasurementUnit.html#~getAll">getAll</a></li></ul></li><li><a href="module-models_Menu.html">models/Menu</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~addIngredient">addIngredient</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~getAllNames">getAllNames</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~buildMenus">buildMenus</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~buildMenusNames">buildMenusNames</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~update">update</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~setIllustration">setIllustration</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~updateIngredient">updateIngredient</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~delete">delete</a></li><li data-type='method' style='display: none;'><a href="module-models_Menu.html#~deleteIngredient">deleteIngredient</a></li></ul></li><li><a href="module-models_MenusStatistics.html">models/MenusStatistics</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_MenusStatistics.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_MenusStatistics.html#~getToday">getToday</a></li><li data-type='method' style='display: none;'><a href="module-models_MenusStatistics.html#~getTodayByMenuId">getTodayByMenuId</a></li><li data-type='method' style='display: none;'><a href="module-models_MenusStatistics.html#~getWeek">getWeek</a></li></ul></li><li><a href="module-models_MenuTypes.html">models/MenuTypes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_MenuTypes.html#~getByName">getByName</a></li><li data-type='method' style='display: none;'><a href="module-models_MenuTypes.html#~getAll">getAll</a></li></ul></li><li><a href="module-models_Order.html">models/Order</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Order.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~getByUserId">getByUserId</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~getByBookingId">getByBookingId</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~getAllToday">getAllToday</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~buildOrders">buildOrders</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~update">update</a></li><li data-type='method' style='display: none;'><a href="module-models_Order.html#~delete">delete</a></li></ul></li><li><a href="module-models_OrderMenus.html">models/OrderMenus</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~addMultiple">addMultiple</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~getAllByUserId">getAllByUserId</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~getAllWaiting">getAllWaiting</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~getBookingMenusByUserId">getBookingMenusByUserId</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~getBookingMenusByBookingId">getBookingMenusByBookingId</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~getAllByOrderId">getAllByOrderId</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~buildOrderMenus">buildOrderMenus</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~updateMenusToReadyByOrder">updateMenusToReadyByOrder</a></li><li data-type='method' style='display: none;'><a href="module-models_OrderMenus.html#~updateMenuToWaitingByOrder">updateMenuToWaitingByOrder</a></li></ul></li><li><a href="module-models_Payment.html">models/Payment</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Payment.html#~payTakeAway">payTakeAway</a></li><li data-type='method' style='display: none;'><a href="module-models_Payment.html#~payBooking">payBooking</a></li></ul></li><li><a href="module-models_Role.html">models/Role</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Role.html#~getByName">getByName</a></li><li data-type='method' style='display: none;'><a href="module-models_Role.html#~getAll">getAll</a></li></ul></li><li><a href="module-models_SalesStatistics.html">models/SalesStatistics</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_SalesStatistics.html#~addBenefits">addBenefits</a></li><li data-type='method' style='display: none;'><a href="module-models_SalesStatistics.html#~getToday">getToday</a></li><li data-type='method' style='display: none;'><a href="module-models_SalesStatistics.html#~getWeek">getWeek</a></li></ul></li><li><a href="module-models_Stock.html">models/Stock</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~addOrEdit">addOrEdit</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~getByName">getByName</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~getIdOf">getIdOf</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~update">update</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~reduce">reduce</a></li><li data-type='method' style='display: none;'><a href="module-models_Stock.html#~delete">delete</a></li></ul></li><li><a href="module-models_StockStatistics.html">models/StockStatistics</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_StockStatistics.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_StockStatistics.html#~getToday">getToday</a></li><li data-type='method' style='display: none;'><a href="module-models_StockStatistics.html#~getTodayByStockId">getTodayByStockId</a></li><li data-type='method' style='display: none;'><a href="module-models_StockStatistics.html#~getWeek">getWeek</a></li></ul></li><li><a href="module-models_Table.html">models/Table</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Table.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_Table.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_Table.html#~getByTableCapacity">getByTableCapacity</a></li><li data-type='method' style='display: none;'><a href="module-models_Table.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-models_Table.html#~update">update</a></li><li data-type='method' style='display: none;'><a href="module-models_Table.html#~delete">delete</a></li></ul></li><li><a href="module-models_Token.html">models/Token</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Token.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_Token.html#~getNew">getNew</a></li><li data-type='method' style='display: none;'><a href="module-models_Token.html#~getUserId">getUserId</a></li></ul></li><li><a href="module-models_Unit.html">models/Unit</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_Unit.html#~getAll">getAll</a></li></ul></li><li><a href="module-models_User.html">models/User</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-models_User.html#~add">add</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~addStaff">addStaff</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~login">login</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~loginWithToken">loginWithToken</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~getStaff">getStaff</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~getByEmail">getByEmail</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~update">update</a></li><li data-type='method' style='display: none;'><a href="module-models_User.html#~deleteStaff">deleteStaff</a></li></ul></li><li><a href="module-Checkers.html">Checkers</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isDefined">isDefined</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~strInRange">strInRange</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isGreaterThan">isGreaterThan</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isDateLowerThan">isDateLowerThan</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isEmail">isEmail</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isPasswordSafe">isPasswordSafe</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isString">isString</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isEmptyString">isEmptyString</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isNumber">isNumber</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isArray">isArray</a></li><li data-type='method' style='display: none;'><a href="module-Checkers.html#~isDate">isDate</a></li></ul></li><li><a href="module-Converters.html">Converters</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Converters.html#~toNumber">toNumber</a></li><li data-type='method' style='display: none;'><a href="module-Converters.html#~toDate">toDate</a></li></ul></li><li><a href="module-Functions.html">Functions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Functions.html#~getFieldsToUpdate">getFieldsToUpdate</a></li><li data-type='method' style='display: none;'><a href="module-Functions.html#~convertValue">convertValue</a></li></ul></li><li><a href="module-Mail.html">Mail</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Mail.html#~sendPassword">sendPassword</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="config.html">config</a></li></ul><h3>Global</h3><ul><li><a href="global.html#startServer">startServer</a></li><li><a href="global.html#getStartedMessage">getStartedMessage</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">api/models/Order.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module models/Order */
import { getFieldsToUpdate } from "../../global/Functions.js";
import Booking from "./Booking.js";
import OrderMenus from "./OrderMenus.js";
import User from "./User.js";
import ModelError from "../../global/ModelError.js";
import Checkers from "../../global/Checkers.js";

/**
 * An Order
 * @typedef {Object} Order
 * @property {Number} order_id - ID of the order
 * @property {Number} [booking_id] - ID of the booking associated with this order
 * @property {Number} user_id - The user ID who made this order
 * @property {string} [additional_infos] - Additional information provided by the user
 * @property {Date|string} time - Time the order was added
 * @property {Number} total_price - Total price of this order
 * @property {Boolean} is_take_away - Is take away
 * @property {Boolean} is_finished - Does the waiter give this order
 */

/**
 * A Full order
 * @typedef {Object} FullOrder
 * @property {Number} order_id - ID of the order
 * @property {Booking} booking - The booking associated with this order
 * @property {User} user - The user who made this order
 * @property {string} [additional_infos] - Additional information provided by the user
 * @property {Date|string} time - Time the order was added
 * @property {Number} total_price - Total price of this order
 * @property {Boolean} is_take_away - Is take away
 * @property {Boolean} is_finished - Does the waiter give this order
 */

/*****************************************************
 * CRUD Methods
 *****************************************************/

/* ---- CREATE ---------------------------------- */
/**
 * @async
 * @function add
 * @description Add an order
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Number|string} [booking_id] - ID of the booking associated with this order
 * @param {Number|string} user_id - The user who made this order
 * @param {string} [additional_infos] - Additional information provided by the user
 * @param {Array&lt;Menu>} menus - The menus of this order
 * @param {Boolean} is_take_away - Is take away
 * @returns {Promise&lt;void|ModelError>} Nothing or a ModelError
 *
 * @example
 * 	Order.add(db, 94, 7, null, [&lt;Menu>, &lt;Menu>, ...], false)
 */
const add = async (db, booking_id, user_id, additional_infos, menus, is_take_away) => {
	if (!Checkers.strInRange(additional_infos, null, 1000, true, true)) {
		return new ModelError(400, "Les informations complémentaires ne peuvent pas dépasser 255 caractères.", ["additional_infos"]);
	}

	// Check the user
	const user = await User.getById(db, user_id);

	if (!user) {
		return new ModelError(400, `L'ID utilisateur "${user_id} ne correspond à personne."`);
	}

	// Get the price
	let price = 0;
	menus.map(menu => price += menu.price);

	// Add the order
	const order = await db.query(`
		INSERT INTO orders(booking_id, user_id, additional_infos, total_price, is_take_away, is_finished)
		VALUES (?, ?, ?, ?, ? ,?)`, [booking_id ? booking_id : null, user_id, additional_infos ? additional_infos : null, price, is_take_away, false]
	);
	const orderId = order.insertId;

	return OrderMenus.addMultiple(db, orderId, menus);
};

/* ---- READ ---------------------------------- */
/**
 * @async
 * @function getById
 * @description Get an order by its ID
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Number|string} order_id - ID of the order
 * @returns {Promise&lt;FullOrder|ModelError>} A full order or a ModelError
 *
 * @example
 * 	Order.getById(db, 30)
 */
const getById = async (db, order_id) => {
	const order = await db.query(`
		SELECT
			order_id,
			booking_id,
			user_id,
			additional_infos,
			time,
			total_price,
			is_take_away,
			is_finished
		FROM orders
		WHERE order_id = ?
	`, [order_id]);

	if (!order[0]) {
		return new ModelError(404, `Aucune commande n'a été trouvée avec l'ID "${order_id}".`);
	}

	return await buildOrders(db, order[0]);
};

/**
 * @async
 * @function getByUserId
 * @description Get an order by its associated user's ID
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Number|string} user_id - ID of the user
 * @returns {Promise&lt;Array&lt;FullOrder>|ModelError>} A list of full orders or a ModelError
 *
 * @example
 * 	Order.getByUserId(db, 4)
 */
const getByUserId = async (db, user_id) => {
	const orders = await db.query(`
		SELECT
  		order_id,
  		booking_id,
    	user_id,
    	additional_infos,
    	time,
    	total_price,
    	is_take_away,
    	is_finished
		FROM orders
		WHERE user_id = ?
	`, [user_id]);

	return buildOrders(db, orders);
};

/**
 * @async
 * @function getByBookingId
 * @description Get all orders of a booking by its ID
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Number|string} booking_id - ID of the booking
 * @returns {Promise&lt;Array&lt;FullOrder>|ModelError>} A list of full orders or a ModelError
 *
 * @example
 * 	Order.getByBookingId(db, 4)
 */
const getByBookingId = async (db, booking_id) => {
	const orders = await db.query(`
		SELECT
  		order_id,
  		booking_id,
    	user_id,
    	additional_infos,
    	time,
    	total_price,
    	is_take_away,
    	is_finished
		FROM orders
		WHERE booking_id = ?
	`, [booking_id]);

	return buildOrders(db, orders);
};

/**
 * @async
 * @function getAll
 * @description Get all orders
 *
 * @param {Promise&lt;void>} db - Database connection
 * @returns {Promise&lt;Array&lt;FullOrder>>} A list of full orders
 *
 * @example
 * 	Order.getAll(db)
 */
const getAll = async db => {
	const orders = await db.query(`
		SELECT
		order_id,
    booking_id,
    user_id,
    additional_infos,
    time,
   	total_price,
    is_take_away,
    is_finished
		FROM orders
		ORDER BY order_id
	`);

	return buildOrders(db, orders);
};

/**
 * @async
 * @function getAllToday
 * @description Get all orders of the day
 *
 * @param {Promise&lt;void>} db - Database connection
 * @returns {Promise&lt;Array&lt;FullOrder>>} A list of full orders
 *
 * @example
 * 	Order.getAllToday(db)
 */
const getAllToday = async db => {
	const orders = await db.query(`
	SELECT
		order_id,
  	booking_id,
    user_id,
    additional_infos,
    time,
   	total_price,
    is_take_away,
    is_finished
	FROM orders
	WHERE
		time >= timestamp(CURRENT_DATE)
	  AND time &lt; ADDDATE(timestamp(CURRENT_DATE), 1)
	ORDER BY time DESC
	`);

	return buildOrders(db, orders);
};

/**
 * @async
 * @function buildOrders
 * @description Replace foreign keys by the corresponding data
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Array&lt;Order>|Order} orders - One or multiple orders
 * @returns {Promise&lt;Array&lt;FullOrder>|FullOrder>} One or multiple full orders
 *
 * @example
 * 	Order.buildOrders(db, [&lt;Order>, &lt;Order>, ...])
 *Order.buildOrders(db, &lt;Order>)
 */
const buildOrders = async (db, orders) => {
	const build = async order => {
		const user = await User.getById(db, order.user_id);
		let booking = await Booking.getById(db, order.booking_id);
		booking = booking instanceof ModelError ? null : {
			booking_id: booking.booking_id,
			user_id: booking.user.user_id,
			table_id: booking.table.table_id,
			time: booking.time,
			clients_nb: booking.clients_nb
		};

		return {
			order_id: order.order_id,
			user: {
				user_id: user.user_id,
				role: user.role,
				first_name: user.first_name,
				last_name: user.last_name,
				email: user.email
			},
			booking: booking,
			additional_infos: order.additional_infos,
			total_price: order.total_price,
			is_take_away: order.is_take_away,
			is_finished: order.is_finished,
			time: order.time
		};
	};

	if (Checkers.isArray(orders)) {
		const fullOrders = [];

		for (const order of orders) {
			fullOrders.push(await build(order));
		}

		return fullOrders;
	} else {
		return await build(orders);
	}
};

/* ---- UPDATE ---------------------------------- */
/**
 * @async
 * @function update
 * @description Update an order using its ID
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Number|string} order_id - ID of the order
 * @param {string} [additional_infos] - Additional information provided by the user
 * @param {Number} [total_price] - Total price of this order
 * @param {Boolean} [is_finished] - Does the waiter give this order
 * @returns {Promise&lt;void|ModelError>} Nothing or a ModelError
 *
 * @example
 * 	Order.update(db, 41, "J'aime pas la salade", null, null, null)
 */
const update = async (db, order_id, additional_infos, total_price, is_finished) => {
	if (!Checkers.strInRange(additional_infos, null, 1000, true, true)) {
		return new ModelError(400, "Les informations complémentaires ne peuvent pas dépasser 255 caractères.", ["additional_infos"]);
	}

	const updatingFields = getFieldsToUpdate({ additional_infos, total_price, is_finished });
	if (!updatingFields) return new ModelError(200, "Rien à mettre à jour.");

	return db.query(`UPDATE orders SET ${updatingFields} WHERE order_id = ?`, [order_id]);
};

/* ---- DELETE ---------------------------------- */
/**
 * @async
 * @function delete
 * @description Delete an order using its ID
 *
 * @param {Promise&lt;void>} db - Database connection
 * @param {Number|string} order_id - ID of the order
 * @returns {Promise&lt;void>}
 *
 * @example
 * 	Order.delete(db, 41)
 */
const del = async (db, order_id) => {
	return db.query("DELETE FROM orders WHERE order_id = ?", [order_id]);
};

/*****************************************************
 * Export
 *****************************************************/

const Order = { add, getById, getByUserId, getByBookingId, getAll, getAllToday, update, delete: del };
export default Order;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Jun 13 2021 19:44:49 GMT+0200 (heure d’été d’Europe centrale) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
